"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},_=require("underscore");module.exports=function(t){t.Status=function(t,e){return this.data={},this.inboxType="default",this.query=null,t&&"object"===("undefined"==typeof t?"undefined":_typeof(t))?this.data=t:(t&&(this.data.image=t),e&&(this.data.message=e)),this},t.Status.prototype={get:function(t){return this.data[t]},set:function(t,e){return this.data[t]=e,this},destroy:function(e){if(!this.id)return t.Promise.error("The status id is not exists.")._thenRunCallbacks(e);var r=t._request("statuses",null,this.id,"DELETE");return r._thenRunCallbacks(e)},toObject:function(){return this.id?t.Object.createWithoutData("_Status",this.id):null},_getDataJSON:function(){var e=t._.clone(this.data);return t._encode(e)},send:function(e){if(!t.User.current())throw"Please signin an user.";if(!this.query)return t.Status.sendStatusToFollowers(this,e);var r=this.query.toJSON();r.className=this.query.className;var n={};n.query=r,this.data=this.data||{};var a=t.Object.createWithoutData("_User",t.User.current().id)._toPointer();this.data.source=this.data.source||a,n.data=this._getDataJSON(),n.inboxType=this.inboxType||"default";var s=t._request("statuses",null,null,"POST",n),u=this;return s.then(function(e){return u.id=e.objectId,u.createdAt=t._parseDate(e.createdAt),u})._thenRunCallbacks(e)},_finishFetch:function(e){this.id=e.objectId,this.createdAt=t._parseDate(e.createdAt),this.updatedAt=t._parseDate(e.updatedAt),this.messageId=e.messageId,delete e.messageId,delete e.objectId,delete e.createdAt,delete e.updatedAt,this.data=t._decode(void 0,e)}},t.Status.sendStatusToFollowers=function(e,r){if(!t.User.current())throw"Please signin an user.";var n={};n.className="_Follower",n.keys="follower";var a=t.Object.createWithoutData("_User",t.User.current().id)._toPointer();n.where={user:a};var s={};s.query=n,e.data=e.data||{},e.data.source=e.data.source||a,s.data=e._getDataJSON(),s.inboxType=e.inboxType||"default";var u=t._request("statuses",null,null,"POST",s);return u.then(function(r){return e.id=r.objectId,e.createdAt=t._parseDate(r.createdAt),e})._thenRunCallbacks(r)},t.Status.sendPrivateStatus=function(e,r,n){if(!t.User.current())throw"Please signin an user.";if(!r)throw"Invalid target user.";var a=_.isString(r)?r:r.id;if(!a)throw"Invalid target user.";var s={};s.className="_User";var u=t.Object.createWithoutData("_User",t.User.current().id)._toPointer();s.where={objectId:a};var i={};i.query=s,e.data=e.data||{},e.data.source=e.data.source||u,i.data=e._getDataJSON(),i.inboxType="private",e.inboxType="private";var o=t._request("statuses",null,null,"POST",i);return o.then(function(r){return e.id=r.objectId,e.createdAt=t._parseDate(r.createdAt),e})._thenRunCallbacks(n)},t.Status.countUnreadStatuses=function(e){if(!t.User.current()&&null==e)throw"Please signin an user or pass the owner objectId.";e=e||t.User.current();var r=_.isString(arguments[1])?arguments[2]:arguments[1],n=_.isString(arguments[1])?arguments[1]:"default",a={};a.inboxType=t._encode(n),a.owner=t._encode(e);var s=t._request("subscribe/statuses/count",null,null,"GET",a);return s._thenRunCallbacks(r)},t.Status.statusQuery=function(e){var r=new t.Query("_Status");return e&&r.equalTo("source",e),r},t.InboxQuery=t.Query._extend({_objectClass:t.Status,_sinceId:0,_maxId:0,_inboxType:"default",_owner:null,_newObject:function(){return new t.Status},_createRequest:function(e){return t._request("subscribe/statuses",null,null,"GET",e||this.toJSON())},sinceId:function(t){return this._sinceId=t,this},maxId:function(t){return this._maxId=t,this},owner:function(t){return this._owner=t,this},inboxType:function(t){return this._inboxType=t,this},toJSON:function(){var e=t.InboxQuery.__super__.toJSON.call(this);return e.owner=t._encode(this._owner),e.inboxType=t._encode(this._inboxType),e.sinceId=t._encode(this._sinceId),e.maxId=t._encode(this._maxId),e}}),t.Status.inboxQuery=function(e,r){var n=new t.InboxQuery(t.Status);return e&&(n._owner=e),r&&(n._inboxType=r),n}};