"use strict";var _=require("underscore");module.exports=function(t){t.GeoPoint=function(i,e){_.isArray(i)?(t.GeoPoint._validate(i[0],i[1]),this.latitude=i[0],this.longitude=i[1]):_.isObject(i)?(t.GeoPoint._validate(i.latitude,i.longitude),this.latitude=i.latitude,this.longitude=i.longitude):_.isNumber(i)&&_.isNumber(e)?(t.GeoPoint._validate(i,e),this.latitude=i,this.longitude=e):(this.latitude=0,this.longitude=0);var o=this;this.__defineGetter__&&this.__defineSetter__&&(this._latitude=this.latitude,this._longitude=this.longitude,this.__defineGetter__("latitude",function(){return o._latitude}),this.__defineGetter__("longitude",function(){return o._longitude}),this.__defineSetter__("latitude",function(i){t.GeoPoint._validate(i,o.longitude),o._latitude=i}),this.__defineSetter__("longitude",function(i){t.GeoPoint._validate(o.latitude,i),o._longitude=i}))},t.GeoPoint._validate=function(t,i){if(-90>t)throw"AV.GeoPoint latitude "+t+" < -90.0.";if(t>90)throw"AV.GeoPoint latitude "+t+" > 90.0.";if(-180>i)throw"AV.GeoPoint longitude "+i+" < -180.0.";if(i>180)throw"AV.GeoPoint longitude "+i+" > 180.0."},t.GeoPoint.current=function(i){var e=new t.Promise;return navigator.geolocation.getCurrentPosition(function(i){e.resolve(new t.GeoPoint({latitude:i.coords.latitude,longitude:i.coords.longitude}))},function(t){e.reject(t)}),e._thenRunCallbacks(i)},t.GeoPoint.prototype={toJSON:function(){return t.GeoPoint._validate(this.latitude,this.longitude),{__type:"GeoPoint",latitude:this.latitude,longitude:this.longitude}},radiansTo:function(t){var i=Math.PI/180,e=this.latitude*i,o=this.longitude*i,n=t.latitude*i,u=t.longitude*i,d=e-n,a=o-u,l=Math.sin(d/2),r=Math.sin(a/2),s=l*l+Math.cos(e)*Math.cos(n)*r*r;return s=Math.min(1,s),2*Math.asin(Math.sqrt(s))},kilometersTo:function(t){return 6371*this.radiansTo(t)},milesTo:function(t){return 3958.8*this.radiansTo(t)}}};